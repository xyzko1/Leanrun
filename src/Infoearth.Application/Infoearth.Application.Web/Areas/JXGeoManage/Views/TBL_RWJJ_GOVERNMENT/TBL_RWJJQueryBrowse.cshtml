@{
    ViewBag.Title = "列表页面";
    Layout = "~/Views/Shared/_IndexMap.cshtml";
}
<style>
    .ui-layout-resizer {
        background: #f5f5f5 !important;
    }

    .ui-jqgrid-view td {
        border-right: 1px solid #ccc !important;
    }

    .ui-jqgrid-view tr:nth-child(odd) {
        background: #DCDCDC;
    }

    .fa-folder-open {
        color: transparent !important;
        background: url("../../Content/images/zTreeStandard.png") no-repeat;
        background-position: -110px -16px;
        margin-right: 2px;
        width: 16px !important;
        height: 16px !important;
    }

    .fa-folder {
        color: transparent !important;
        background: url("../../Content/images/zTreeStandard.png") no-repeat;
        background-position: -110px 0;
        margin-right: 2px;
        width: 16px !important;
        height: 16px !important;
    }

    .fa-file-o {
        color: transparent !important;
        background: url("../../Content/images/zTreeStandard.png") no-repeat;
        background-position: -110px -32px;
        width: 16px !important;
        height: 16px !important;
    }
</style>
<div class="ui-layout" id="layout" style="height: 100%; width: 100%;">
    <div class="ui-layout-west" style="height:100%">
        <div class="west-Panel" style="margin:0px;height:100%">
            <div class="panel-Title" style="height:40px;line-height:40px;background-color: rgba(236, 247, 255, 1);color:#000">行政区划</div>
            <div id="itemTree"></div>
        </div>
    </div>
    <div class="ui-layout-center" id="ui_center">
        <div class="center-Panel" style="height: 100%;width:100%;margin-top:0px;overflow-y:hidden;">
            <div id="DZHJManage" style="width:100%;height:45px;background:#fff">
                <ul class="nav nav-tabs" style="background:rgba(236, 247, 255, 1)">
                    <li class="active" id="li_GOV"><a href="#GOV" data-toggle="tab">政府</a></li>
                    <li id="li_ENTER"><a href="#ENTER" data-toggle="tab">企业</a></li>
                    <li id="li_HOSPITAL"><a href="#HOSPITAL" data-toggle="tab">医院</a></li>
                    <li id="li_SCHOOL"><a href="#SCHOOL" data-toggle="tab">学校</a></li>
                    <li id="li_RESIDENT"><a href="#RESIDENT" data-toggle="tab">居民住宅</a></li>
                </ul>
                <div id="myTabContent" class="tab-content" style="height: 100%; width: 100%;"></div>
            </div>
            <div class="ui-layout" id="layout2" style="height: 100%; width: 100%;">
                <div class="ui-layout-north" id="ui_map" style="height: 350px;">
                    <div id="mapControl" style="height:350px;"></div>
                </div>
                <div class="ui-layout-center" id="ui_grid">
                    <div class="titlePanel" style="height:40px;line-height:40px">
                        <div class="title-search" id="filter-form" style="height:40px;line-height:40px">
                            <table>
                                <tr>
                                    <td>
                                        <input id="NAME" type="text" class="form-control" placeholder="请输入名称" style="width: 160px;" />
                                    </td>
                                    <td style="padding-left: 5px;">
                                        <a id="btn_Search" class="btn btn-primary"><i class="fa fa-search"></i>查询</a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="" style="float:right;margin-right:10px;height:40px;line-height:40px;display:flex;align-items: center;">
                            <div class="btn-group">
                                <a id="lr-replace" class="btn btn-default" onclick="reload()"><i class="fa fa-refresh"></i>刷新</a>
                                <a id="lr-message" class="btn btn-default" onclick="btn_message()"><i class="fa fa-pencil-square-o"></i>详情</a>
                                <a id="lr-colgrid" class="btn btn-default" onclick="ColDataGrid()"><i class="fa fa-chevron-down"></i>列表</a>
                                <a id="lr-colmap" class="btn btn-default" onclick="ColMapDiv()"><i class="fa fa-chevron-up"></i>地图</a>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content">
                        <div class="tab-pane fade in active" id="GOV">
                            <div class="gridPanel" id="gridPanel1">
                                <table id="gridTable1"></table>
                                <div id="gridPager1"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="ENTER">
                            <div class="gridPanel" id="gridPanel2">
                                <table id="gridTable2"></table>
                                <div id="gridPager2"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="HOSPITAL">
                            <div class="gridPanel" id="gridPanel3">
                                <table id="gridTable3"></table>
                                <div id="gridPager3"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="SCHOOL">
                            <div class="gridPanel" id="gridPanel4">
                                <table id="gridTable4"></table>
                                <div id="gridPager4"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="RESIDENT">
                            <div class="gridPanel" id="gridPanel5">
                                <table id="gridTable5"></table>
                                <div id="gridPager5"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




@section Scripts{
<script>
    var layout2NorthH = 1;
    var tabvalue = "政府";
    var gridId = "gridTable1";
    var authToken = getAuthorizationToken();
    var dialog = request('dialog');
    var AreaCode = "340000", PROVINCE = "", CITY = "", COUNTY = "";
    var LATITUDE, LONGITUDE;
    var linkUrl = '/JXGeoManage/TBL_RWJJ_GOVERNMENT/TBL_RWJJ_GOVERNMENTForm';
    var delUrl = '../../JXGeoManage/TBL_RWJJ_GOVERNMENT/RemoveForm';
    var queryUrl = "../../JXGeoManage/TBL_RWJJ_GOVERNMENT/GetPageListJson";
    $(function () {
        InitialPage();
        GetMapData();
        GetTree();
        GetGovGrid();
        BindMapMarkerGov();
        //查询点击事件
        $("#btn_Search").click(function () {
            SearchEvent();
        });
        $(".nav-tabs li a").click(function () {
            tabvalue = this.innerHTML;
            GetUrl(tabvalue);
            var queryJson = $("#filter-form").getWebControls();
            queryJson["DISASTERTYPE"] = tabvalue;
            queryJson["PROVINCE"] = PROVINCE;
            queryJson["CITY"] = CITY;
            queryJson["COUNTY"] = COUNTY;
        })
    });
    //获取地址
    function GetUrl(v) {
        switch (v) {
            case "政府":
                queryUrl = "../../JXGeoManage/TBL_RWJJ_GOVERNMENT/GetPageListJson";
                linkUrl = '/JXGeoManage/TBL_RWJJ_GOVERNMENT/TBL_RWJJ_GOVERNMENTForm';
                delUrl = '../../JXGeoManage/TBL_RWJJ_GOVERNMENT/RemoveForm';
                GetGovGrid();
                BindMapMarkerGov();
                gridId = "gridTable1";
                break;
            case "企业":
                queryUrl = "../../JXGeoManage/TBL_RWJJ_ENTERPRISE/GetPageListJson";
                linkUrl = '/JXGeoManage/TBL_RWJJ_ENTERPRISE/TBL_RWJJ_ENTERPRISEForm';
                delUrl = '../../JXGeoManage/TBL_RWJJ_ENTERPRISE/RemoveForm';
                GetEnterGrid();
                BindMapMarkerEnter();
                gridId = "gridTable2";
                break;
            case "医院":
                queryUrl = "../../JXGeoManage/TBL_RWJJ_HOSPITAL/GetPageListJson";
                linkUrl = '/JXGeoManage/TBL_RWJJ_HOSPITAL/TBL_RWJJ_HOSPITALForm';
                delUrl = '../../JXGeoManage/TBL_RWJJ_HOSPITAL/RemoveForm';
                GetHospitalGrid();
                BindMapMarkerHospital();
                gridId = "gridTable3";
                break;
            case "学校":
                queryUrl = "../../JXGeoManage/TBL_RWJJ_SCHOOL/GetPageListJson";
                linkUrl = '/JXGeoManage/TBL_RWJJ_SCHOOL/TBL_RWJJ_SCHOOLForm';
                delUrl = '../../JXGeoManage/TBL_RWJJ_SCHOOL/RemoveForm';
                GetSchoolGrid();
                BindMapMarkerSchool();
                gridId = "gridTable4";
                break;
            case "居民住宅":
                queryUrl = "../../JXGeoManage/TBL_RWJJ_RESIDENTIALAREA/GetPageListJson";
                linkUrl = '/JXGeoManage/TBL_RWJJ_RESIDENTIALAREA/TBL_RWJJ_RESIDENTIALAREAForm';
                delUrl = '../../JXGeoManage/TBL_RWJJ_RESIDENTIALAREA/RemoveForm';
                GetResidentGrid();
                BindMapMarkerResident();
                gridId = "gridTable5";
                break;
            default:
                break;
        }
    }
    //初始化页面
    function InitialPage() {
        //layout布局
        $('#layout').layout({
            west__size: 190,
            applyDemoStyles: true,
            onresize: function () {
                if (isResize < 10) {
                    isResize++;
                }
                resize();
            }
        });
        var isResize = 0;
        var count = 0;
        var resized = 0;
        var layout = $('#layout2').layout({
            applyDemoStyles: true,
            onresize: function () {
                resize();
                if (isResize > 1) {
                    resized = 1;
                } else {
                    if (count == 1 || resized == 0) {
                        $('#layout2 .ui-layout-center').height($('#layout2 .ui-layout-center').height() - 18);
                    }
                }
                count++;
            }
        });

        //layout.sizePane("")
        //resize重设布局;
        $(window).resize(function (e) {
            if (isResize < 10) {
                isResize++;
            }
            resize();
            e.stopPropagation();
        });
        function resize() {
            window.setTimeout(function () {
                if (mapCtlExt != null) {
                    mapCtlExt.setHeight($('#mapControl').parent().height() - 4);
                }
                $('#layout2 .ui-layout-center').width($('#layout2 .ui-layout-center').parent().width());
                $('.ui-jqgrid-bdiv').height($('#layout2 .ui-layout-center').height() - 60 - 60);
                $('#layout2 .ui-layout-center').height($('#layout2').height() - $('#layout2 .ui-layout-north').height() - 15);
                $('#gridTable1').setGridWidth(($('.tab-content').width()));
                $('#gridTable1').setGridHeight($('#layout2 .ui-layout-center').height() - 145 + 12);
                $('#gridTable2').setGridWidth(($('.tab-content').width()));
                $('#gridTable2').setGridHeight($('#layout2 .ui-layout-center').height() - 145 + 12);
                $('#gridTable3').setGridWidth(($('.tab-content').width()));
                $('#gridTable3').setGridHeight($('#layout2 .ui-layout-center').height() - 145 + 12);
                $('#gridTable4').setGridWidth(($('.tab-content').width()));
                $('#gridTable4').setGridHeight($('#layout2 .ui-layout-center').height() - 145 + 12);
                $('#gridTable5').setGridWidth(($('.tab-content').width()));
                $('#gridTable5').setGridHeight($('#layout2 .ui-layout-center').height() - 145 + 12);
                $('#layout2 .ui-layout-center').css('overflow', 'hidden');
            }, 200);
        };
        $(window).resize();
        $('#layout2 .ui-layout-center').height($('#layout2 .ui-layout-center').height() - 18);
        layout2NorthH = $("#layout2 .ui-layout-north").height();
    }
    //加载行政区划树
    function GetTree() {
        var item = {
            height: $(window).height() - 52,
            isAllExpand: false,
            url: "../../Map/GetTreeJsonForMap",
            onnodeclick: function (item) {
                AreaCode = item.id;
                var level = item.value.split(',')[1];
                if (level == 1) {
                    PROVINCE = item.id;
                    CITY = "";
                    COUNTY = "";
                } else if (level == 2) {
                    PROVINCE = item.id.substring(0, 2) + "0000";
                    CITY = item.id;
                    COUNTY = "";
                } else if (level == 3) {
                    PROVINCE = item.id.substring(0, 2) + "0000";
                    CITY = item.id.substring(0, 4) + "00";
                    COUNTY = item.id;
                }
                var data = [{
                    latitude: item.value.split(',')[3],
                    longitude: item.value.split(',')[2],
                    popupHtml: ""
                }]
                mapCtlExt.addLocation(data, false, level);
                $('#btn_Search').trigger("click");
            },
        };
        //初始化
        $("#itemTree").treeview(item);
    };
    //加载地图
    var mapCtlExt = null;
    function GetMapData() {
        mapCtlExt = $("#mapControl").mapCtl(
            cfGetMapData({
            })
        );
    };
    //加载政府表格
    function GetGovGrid() {
        var selectedRowIndex = 0;
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue;
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        var $gridTable = $('#gridTable1');
        $gridTable.jqGrid({
            autowidth: true,
            postData: { queryJson: JSON.stringify(queryJson) },
            height: $('#layout2 .ui-layout-center').height() - 145 + 12,
            url: queryUrl,
            datatype: "json",
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            colModel: [
                { label: 'ID', name: 'UNIFIEDCODE', index: 'UNIFIEDCODE', width: 300, align: 'left', sortable: false, hidden: true },
                { label: '单位名称', name: 'NAME', index: 'NAME', width: 180, align: 'left', sortable: false },
                { label: '身份证号', name: 'CARDID', index: 'CARDID', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '经度', name: 'LONGITUDE', index: 'LONGITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '纬度', name: 'LATITUDE', index: 'LATITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '区县', name: 'CITY', index: 'CITY', width: 140, align: 'left', sortable: false },
                { label: '乡镇', name: 'TOWN', index: 'TOWN', width: 140, align: 'left', sortable: false },
                { label: '村组', name: 'VILLAGE', index: 'VILLAGE', width: 140, align: 'left', sortable: false },
                { label: '电话', name: 'PHONE', index: 'PHONE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '手机', name: 'MOBILE', index: 'MOBILE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '联系人', name: 'CONTACTPERSON', index: 'CONTACTPERSON', width: 140, align: 'left', sortable: false },
                { label: '机构级别', name: 'ORGANIZATIONLEVEL', index: 'ORGANIZATIONLEVEL', width: 140, align: 'left', sortable: false },
                { label: '政府ID', name: 'NAMEID', index: 'NAMEID', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '联系人编号', name: 'CONTACTPERSONID', index: 'CONTACTPERSONID', width: 100, align: 'left', sortable: false, hidden: true },
            ],
            viewrecords: true,
            rowNum: 30,
            rowList: [30, 50, 100],
            pager: "#gridPager1",
            sortname: 'UNIFIEDCODE',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: true,
            gridview: true,
            onSelectRow: function (rowId, status) {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                var dt = $gridTable.jqGrid("getRowData", rowId);
                var data = [];
                var longitude = 0, latitude = 0;
                if (dt.LONGITUDE) {
                    longitude = parseFloat(dt.LONGITUDE);
                }
                if (dt.LATITUDE) {
                    latitude = parseFloat(dt.LATITUDE);
                }
                data.push({ longitude: longitude, latitude: latitude });
                mapCtlExt.addLocation(data,true);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }
    //加载企业表格
    function GetEnterGrid() {
        var selectedRowIndex = 0;
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue;
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        var $gridTable = $('#gridTable2');
        $gridTable.jqGrid({
            autowidth: true,
            postData: { queryJson: JSON.stringify(queryJson) },
            height: $('#layout2 .ui-layout-center').height() - 145 + 12,
            url: queryUrl,
            datatype: "json",
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            colModel: [
                { label: 'ID', name: 'UNIFIEDCODE', index: 'UNIFIEDCODE', width: 300, align: 'left', sortable: false, hidden: true },
                { label: '企业名称', name: 'NAME', index: 'NAME', width: 300, align: 'left', sortable: false },
                { label: '身份证号', name: 'CARDID', index: 'CARDID', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '经度', name: 'LONGITUDE', index: 'LONGITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '纬度', name: 'LATITUDE', index: 'LATITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '区县', name: 'CITY', index: 'CITY', width: 120, align: 'left', sortable: false },
                { label: '乡镇', name: 'TOWN', index: 'TOWN', width: 120, align: 'left', sortable: false },
                { label: '村组', name: 'VILLAGE', index: 'VILLAGE', width: 120, align: 'left', sortable: false },
                { label: '修建时间', name: 'CREATETIME', index: 'CREATETIME', width: 120, align: 'left', sortable: false, hidden: true },
                { label: '建筑面积', name: 'AREASTRUCTURE', index: 'AREASTRUCTURE', width: 100, align: 'left', sortable: false },
                { label: '结构类型', name: 'STRUCTURETYPE', index: 'STRUCTURETYPE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '电话', name: 'PHONE', index: 'PHONE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '手机', name: 'MOBILE', index: 'MOBILE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '职工总数', name: 'WORKFORCE', index: 'WORKFORCE', width: 100, align: 'left', sortable: false },
                { label: '日人流量', name: 'VISITORSRATE', index: 'VISITORSRATE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '总资产', name: 'TOTALASSETS', index: 'TOTALASSETS', width: 100, align: 'left', sortable: false },
                { label: '建筑层数', name: 'STOREYNUMBER', index: 'STOREYNUMBER', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '法人', name: 'LEGALPERSON', index: 'LEGALPERSON', width: 120, align: 'left', sortable: false },
                { label: '企业ID', name: 'NAMEID', index: 'NAMEID', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '法人ID', name: 'LEGALPERSONID', index: 'LEGALPERSONID', width: 100, align: 'left', sortable: false, hidden: true },
            ],
            viewrecords: true,
            rowNum: 30,
            rowList: [30, 50, 100],
            pager: "#gridPager2",
            sortname: 'UNIFIEDCODE',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: true,
            gridview: true,
            onSelectRow: function (rowId, status) {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                var dt = $gridTable.jqGrid("getRowData", rowId);
                var data = [];
                var longitude = 0, latitude = 0;
                if (dt.LONGITUDE) {
                    longitude = parseFloat(dt.LONGITUDE);
                }
                if (dt.LATITUDE) {
                    latitude = parseFloat(dt.LATITUDE);
                }
                data.push({ longitude: longitude, latitude: latitude });
                mapCtlExt.addLocation(data,true);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }
    //加载医院表格
    function GetHospitalGrid() {
        var selectedRowIndex = 0;
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue;
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        var $gridTable = $('#gridTable3');
        $gridTable.jqGrid({
            autowidth: true,
            postData: { queryJson: JSON.stringify(queryJson) },
            height: $('#layout2 .ui-layout-center').height() - 145 + 12,
            url: queryUrl,
            datatype: "json",
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            colModel: [
                { label: 'ID', name: 'UNIFIEDCODE', index: 'UNIFIEDCODE', width: 300, align: 'left', sortable: false, hidden: true },
                { label: '医院名称', name: 'NAME', index: 'NAME', width: 200, align: 'left', sortable: false },
                { label: '身份证号', name: 'CARDID', index: 'CARDID', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '经度', name: 'LONGITUDE', index: 'LONGITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '纬度', name: 'LATITUDE', index: 'LATITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '区县', name: 'CITY', index: 'CITY', width: 120, align: 'left', sortable: false },
                { label: '乡镇', name: 'TOWN', index: 'TOWN', width: 120, align: 'left', sortable: false },
                { label: '村组', name: 'VILLAGE', index: 'VILLAGE', width: 120, align: 'left', sortable: false },
                { label: '修建时间', name: 'CREATETIME', index: 'CREATETIME', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '建筑面积', name: 'AREASTRUCTURE', index: 'AREASTRUCTURE', width: 100, align: 'left', sortable: false },
                { label: '结构类型', name: 'STRUCTURETYPE', index: 'STRUCTURETYPE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '电话', name: 'PHONE', index: 'PHONE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '手机', name: 'MOBILE', index: 'MOBILE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '职工人数', name: 'HOSPITALPEOPLE', index: 'HOSPITALPEOPLE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '总资产', name: 'TOTALASSETS', index: 'TOTALASSETS', width: 100, align: 'left', sortable: false },
                { label: '占地面积', name: 'FLOORSPACE', index: 'FLOORSPACE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '日就诊人', name: 'AVERAGEDAILY', index: 'AVERAGEDAILY', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '病床数', name: 'SICKBEDNUMBER', index: 'SICKBEDNUMBER', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '医护人员数', name: 'MEDICALWORKERS', index: 'MEDICALWORKERS', width: 100, align: 'left', sortable: false },
                { label: '救护车辆数', name: 'AMBULANCE', index: 'AMBULANCE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '医院等级', name: 'HOSPITALRANK', index: 'HOSPITALRANK', width: 100, align: 'left', sortable: false },
                { label: '法人', name: 'LEGALPERSON', index: 'LEGALPERSON', width: 120, align: 'left', sortable: false },
                { label: '医院ID', name: 'NAMEID', index: 'NAMEID', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '法人ID', name: 'LEGALPERSONID', index: 'LEGALPERSONID', width: 100, align: 'left', sortable: false, hidden: true },
            ],
            viewrecords: true,
            rowNum: 30,
            rowList: [30, 50, 100],
            pager: "#gridPager3",
            sortname: 'UNIFIEDCODE',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: true,
            gridview: true,
            onSelectRow: function (rowId, status) {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                var dt = $gridTable.jqGrid("getRowData", rowId);
                var data = [];
                var longitude = 0, latitude = 0;
                if (dt.LONGITUDE) {
                    longitude = parseFloat(dt.LONGITUDE);
                }
                if (dt.LATITUDE) {
                    latitude = parseFloat(dt.LATITUDE);
                }
                data.push({ longitude: longitude, latitude: latitude });
                //data.push({ longitude: dt.LONGITUDE, latitude: dt.LATITUDE });
                mapCtlExt.addLocation(data,true);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }
    //加载学校表格
    function GetSchoolGrid() {
        var selectedRowIndex = 0;
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue;
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        var $gridTable = $('#gridTable4');
        $gridTable.jqGrid({
            autowidth: true,
            postData: { queryJson: JSON.stringify(queryJson) },
            height: $('#layout2 .ui-layout-center').height() - 145 + 12,
            url: queryUrl,
            datatype: "json",
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            colModel: [
                { label: 'ID', name: 'UNIFIEDCODE', index: 'UNIFIEDCODE', width: 300, align: 'left', sortable: false, hidden: true },
                { label: '学校名称', name: 'NAME', index: 'NAME', width: 180, align: 'left', sortable: false, hidden: true },
                { label: '身份证号', name: 'CARDID', index: 'CARDID', width: 140, align: 'left', sortable: false },
                { label: '经度', name: 'LONGITUDE', index: 'LONGITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '纬度', name: 'LATITUDE', index: 'LATITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '区县', name: 'CITY', index: 'CITY', width: 120, align: 'left', sortable: false },
                { label: '乡镇', name: 'TOWN', index: 'TOWN', width: 120, align: 'left', sortable: false },
                { label: '村组', name: 'VILLAGE', index: 'VILLAGE', width: 120, align: 'left', sortable: false },
                { label: '修建时间', name: 'CREATETIME', index: 'CREATETIME', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '建筑面积', name: 'AREASTRUCTURE', index: 'AREASTRUCTURE', width: 100, align: 'left', sortable: false},
                { label: '结构类型', name: 'STRUCTURETYPE', index: 'STRUCTURETYPE', width: 120, align: 'left', sortable: false, hidden: true },
                { label: '电话', name: 'PHONE', index: 'PHONE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '手机', name: 'MOBILE', index: 'MOBILE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '学校人数', name: 'SCHOOLPEOPLE', index: 'SCHOOLPEOPLE', width: 100, align: 'left', sortable: false},
                { label: '住校人数', name: 'RESIDENCENUM', index: 'RESIDENCENUM', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '学校总资产', name: 'TOTALASSETS', index: 'TOTALASSETS', width: 100, align: 'left', sortable: false},
                { label: '占地面积', name: 'FLOORSPACE', index: 'FLOORSPACE', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '责任人', name: 'LEGALPERSON', index: 'LEGALPERSON', width: 120, align: 'left', sortable: false },
                { label: '学校ID', name: 'NAMEID', index: 'NAMEID', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '责任人ID', name: 'LEGALPERSONID', index: 'LEGALPERSONID', width: 100, align: 'left', sortable: false, hidden: true },
            ],
            viewrecords: true,
            rowNum: 30,
            rowList: [30, 50, 100],
            pager: "#gridPager4",
            sortname: 'UNIFIEDCODE',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: true,
            gridview: true,
            onSelectRow: function (rowId, status) {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                var dt = $gridTable.jqGrid("getRowData", rowId);
                var data = [];
                var longitude = 0, latitude = 0;
                if (dt.LONGITUDE) {
                    longitude = parseFloat(dt.LONGITUDE);
                }
                if (dt.LATITUDE) {
                    latitude = parseFloat(dt.LATITUDE);
                }
                data.push({ longitude: longitude, latitude: latitude });
                mapCtlExt.addLocation(data,true);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }
    //加载居民住宅表格
    function GetResidentGrid() {
        var selectedRowIndex = 0;
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue;
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        var $gridTable = $('#gridTable5');
        $gridTable.jqGrid({
            autowidth: true,
            postData: { queryJson: JSON.stringify(queryJson) },
            height: $('#layout2 .ui-layout-center').height() - 145 + 12,
            url: queryUrl,
            datatype: "json",
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            colModel: [
                { label: 'ID', name: 'UNIFIEDCODE', index: 'UNIFIEDCODE', width: 300, align: 'left', sortable: false, hidden: true },
                { label: '户主', name: 'NAME', index: 'NAME', width: 180, align: 'left', sortable: false },
                { label: '身份证号', name: 'CARDID', index: 'CARDID', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '经度', name: 'LONGITUDE', index: 'LONGITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '纬度', name: 'LATITUDE', index: 'LATITUDE', width: 100, align: 'left', sortable: true, hidden: true },
                { label: '区县', name: 'CITY', index: 'CITY', width: 120, align: 'left', sortable: false },
                { label: '乡镇', name: 'TOWN', index: 'TOWN', width: 120, align: 'left', sortable: false },
                { label: '村组', name: 'VILLAGE', index: 'VILLAGE', width: 120, align: 'left', sortable: false },
                { label: '电话', name: 'PHONE', index: 'PHONE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '手机', name: 'MOBILE', index: 'MOBILE', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '户数', name: 'HOUSEHOLD', index: 'HOUSEHOLD', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '家庭人口', name: 'FAMILYNUMBER', index: 'FAMILYNUMBER', width: 100, align: 'left', sortable: false},
                { label: '人年均收入', name: 'AVERAGEINCOME', index: 'AVERAGEINCOME', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '修建时间', name: 'CREATETIME', index: 'CREATETIME', width: 140, align: 'left', sortable: false, hidden: true },
                { label: '房屋层数', name: 'STOREYNUMBER', index: 'STOREYNUMBER', width: 100, align: 'left', sortable: false, hidden: true },
                { label: '建筑面积', name: 'AREASTRUCTURE', index: 'AREASTRUCTURE', width: 100, align: 'left', sortable: false},
                { label: '单位造价', name: 'UNITPRICE', index: 'UNITPRICE', width: 100, align: 'left', sortable: false},
                { label: '结构类型', name: 'STRUCTURETYPE', index: 'HOUSEHOLD', width: 120, align: 'left', sortable: false },
                { label: '户主编号', name: 'NAMEID', index: 'NAMEID', width: 100, align: 'left', sortable: false, hidden: true }
            ],
            viewrecords: true,
            rowNum: 30,
            rowList: [30, 50, 100],
            pager: "#gridPager5",
            sortname: 'UNIFIEDCODE',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: true,
            gridview: true,
            onSelectRow: function (rowId, status) {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                var dt = $gridTable.jqGrid("getRowData", rowId);
                var data = [];
                var longitude = 0, latitude = 0;
                if (dt.LONGITUDE) {
                    longitude = parseFloat(dt.LONGITUDE);
                }
                if (dt.LATITUDE) {
                    latitude = parseFloat(dt.LATITUDE);
                }
                data.push({ longitude: longitude, latitude: latitude });
                //data.push({ longitude: dt.LONGITUDE, latitude: dt.LATITUDE });
                mapCtlExt.addLocation(data,true);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }
    //加载地图marker
    function BindMapMarkerGov() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["AreaCode"] = AreaCode;
        $.ajax({
            url: "../../JXGeoManage/TBL_RWJJ_GOVERNMENT/GetListJson",
            data: { queryJson: JSON.stringify(queryJson) },
            beforeSend: function (a) {
                if (authToken != null)
                    a.setRequestHeader("Authorization", authToken);
            },
            type: "GET",
            dataType: 'json',
            success: function (data) {
                var returnValue = [];
                var type = [];
                for (var i = 0; i < data.length; i++) {
                    //详情页面
                    var divhtml = '<div style="font-weight: bold;"></div>';
                    divhtml += '<div style="font-weight: bold;margin-bottom:5px;"><span style="margin-left:10px;">单位名称：</span><span>' + data[i].NAME + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">机构级别：</span><span>' + data[i].ORGANIZATIONLEVEL + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">联系人：</span><span>' + data[i].CONTACTPERSON + '</span></div>';
                    //divhtml += '<span style="margin-right:20px; float:right; cursor: pointer;"><a onclick="MapViewDetail(\'' + data[i].UNIFIEDCODE + '\')" href="#" class="link-detail">详细信息</a></span>';
                    returnValue.push({ id: "all", url: "../../Content/images/人文经济-政府16.png", location: [data[i].LONGITUDE, data[i].LATITUDE], popupHtml: divhtml });
                }
                mapCtlExt.addMarker(returnValue);
            }, error: function (e) {
            },
            cache: false
        });

    };
    function BindMapMarkerEnter() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["AreaCode"] = AreaCode;
        $.ajax({
            url: "../../JXGeoManage/TBL_RWJJ_ENTERPRISE/GetListJson",
            data: { queryJson: JSON.stringify(queryJson) },
            beforeSend: function (a) {
                if (authToken != null)
                    a.setRequestHeader("Authorization", authToken);
            },
            type: "GET",
            dataType: 'json',
            success: function (data) {
                var returnValue = [];
                var type = [];
                for (var i = 0; i < data.length; i++) {
                    //详情页面
                    var divhtml = '<div style="font-weight: bold;"></div>';
                    divhtml += '<div style="font-weight: bold;margin-bottom:5px;"><span style="margin-left:10px;">企业名称：</span><span>' + data[i].NAME + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">建筑面积：</span><span>' + data[i].AREASTRUCTURE + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">总资产：</span><span>' + data[i].TOTALASSETS + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">法人：</span><span>' + data[i].LEGALPERSON + '</span></div>';
                    //divhtml += '<span style="margin-right:20px; float:right; cursor: pointer;"><a onclick="MapViewDetail(\'' + data[i].UNIFIEDCODE + '\')" href="#" class="link-detail">详细信息</a></span>';
                    returnValue.push({ id: "all", url: "../../Content/images/人文经济-企业16.png", location: [data[i].LONGITUDE, data[i].LATITUDE], popupHtml: divhtml });
                }
                mapCtlExt.addMarker(returnValue);
            }, error: function (e) {
            },
            cache: false
        });
    }
    function BindMapMarkerHospital() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["AreaCode"] = AreaCode;
        $.ajax({
            url: "../../JXGeoManage/TBL_RWJJ_HOSPITAL/GetListJson",
            data: { queryJson: JSON.stringify(queryJson) },
            beforeSend: function (a) {
                if (authToken != null)
                    a.setRequestHeader("Authorization", authToken);
            },
            type: "GET",
            dataType: 'json',
            success: function (data) {
                var returnValue = [];
                var type = [];
                for (var i = 0; i < data.length; i++) {
                    //详情页面
                    var divhtml = '<div style="font-weight: bold;"></div>';
                    divhtml += '<div style="font-weight: bold;margin-bottom:5px;"><span style="margin-left:10px;">医院名称：</span><span>' + data[i].NAME + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">医院等级：</span><span>' + data[i].HOSPITALRANK + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">建筑面积：</span><span>' + data[i].AREASTRUCTURE + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">总资产：</span><span>' + data[i].TOTALASSETS + '</span></div>';
                    //divhtml += '<span style="margin-right:20px; float:right; cursor: pointer;"><a onclick="MapViewDetail(\'' + data[i].UNIFIEDCODE + '\')" href="#" class="link-detail">详细信息</a></span>';
                    returnValue.push({ id: "all", url: "../../Content/images/人文经济-医院16.png", location: [data[i].LONGITUDE, data[i].LATITUDE], popupHtml: divhtml });
                }
                mapCtlExt.addMarker(returnValue);
            }, error: function (e) {
            },
            cache: false
        });
    }
    function BindMapMarkerSchool() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["AreaCode"] = AreaCode;
        $.ajax({
            url: "../../JXGeoManage/TBL_RWJJ_SCHOOL/GetListJson",
            data: { queryJson: JSON.stringify(queryJson) },
            beforeSend: function (a) {
                if (authToken != null)
                    a.setRequestHeader("Authorization", authToken);
            },
            type: "GET",
            dataType: 'json',
            success: function (data) {
                var returnValue = [];
                var type = [];
                for (var i = 0; i < data.length; i++) {
                    //详情页面
                    var divhtml = '<div style="font-weight: bold;"></div>';
                    divhtml += '<div style="font-weight: bold;margin-bottom:5px;"><span style="margin-left:10px;">学校名称：</span><span>' + data[i].NAME + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">学校人数：</span><span>' + data[i].SCHOOLPEOPLE + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">建筑面积：</span><span>' + data[i].AREASTRUCTURE + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">总资产：</span><span>' + data[i].TOTALASSETS + '</span></div>';
                    //divhtml += '<span style="margin-right:20px; float:right; cursor: pointer;"><a onclick="MapViewDetail(\'' + data[i].UNIFIEDCODE + '\')" href="#" class="link-detail">详细信息</a></span>';
                    returnValue.push({ id: "all", url: "../../Content/images/人文经济-学校16.png", location: [data[i].LONGITUDE, data[i].LATITUDE], popupHtml: divhtml });
                }
                mapCtlExt.addMarker(returnValue);
            }, error: function (e) {
            },
            cache: false
        });
    }
    function BindMapMarkerResident() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["AreaCode"] = AreaCode;
        $.ajax({
            url: "../../JXGeoManage/TBL_RWJJ_RESIDENTIALAREA/GetListJson",
            data: { queryJson: JSON.stringify(queryJson) },
            beforeSend: function (a) {
                if (authToken != null)
                    a.setRequestHeader("Authorization", authToken);
            },
            type: "GET",
            dataType: 'json',
            success: function (data) {
                var returnValue = [];
                var type = [];
                for (var i = 0; i < data.length; i++) {
                    //详情页面
                    var divhtml = '<div style="font-weight: bold;"></div>';
                    divhtml += '<div style="font-weight: bold;margin-bottom:5px;"><span style="margin-left:10px;">户主：</span><span>' + data[i].NAME + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">家庭人口：</span><span>' + data[i].FAMILYNUMBER + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">建筑面积：</span><span>' + data[i].AREASTRUCTURE + '</span></div>';
                    divhtml += '<div style="margin-bottom:5px;"><span style="margin-left:10px;">单位造价：</span><span>' + data[i].UNITPRICE + '</span></div>';
                    //divhtml += '<span style="margin-right:20px; float:right; cursor: pointer;"><a onclick="MapViewDetail(\'' + data[i].UNIFIEDCODE + '\')" href="#" class="link-detail">详细信息</a></span>';
                    returnValue.push({ id: "all", url: "../../Content/images/人文经济-居民16.png", location: [data[i].LONGITUDE, data[i].LATITUDE], popupHtml: divhtml });
                }
                mapCtlExt.addMarker(returnValue);
            }, error: function (e) {
            },
            cache: false
        });
    }
    function btn_message() {
        var keyValue = $("#" + gridId).jqGridRowValue('UNIFIEDCODE');
        if (checkedRow(keyValue)) {
            ViewMonitorDetail(keyValue);
        }
    }
    function ViewMonitorDetail(keyValue) {
        var url = document.location.protocol + "//" + document.location.host + linkUrl + "?keyValue=" + keyValue + '&IdetIfrem=Idetnew&UNIFIEDCODE=' + keyValue + '&XQing=01' + "&callback=" + document.URL;
        document.location.href = url;
    }
    //地图详情
    function MapViewDetail(type) {
        console.log(type)
        var keyValue = type.split(",")[1];
        var types = type.split(",")[0];
        var title = types;
        if (types == "滑坡") {
            types = "001"
        } else if (types == "崩塌") {
            types = "002"
        } else if (types == "泥石流") {
            types = "003"
        } else if (types == "地面沉降") {
            types = "004"
        } else if (types == "地面塌陷") {
            types = "005"
        } else if (types == "地裂缝") {
            types = "006"
        } else if (types == "斜坡") {
            types = "007"
        }
        if (checkedRow(keyValue)) {
            //top.tablist.newTab({
            //    id: 'DetailForm',
            //    title: title + '详情表',
            //    icon: "fa fa-file-text-o",
            //    url: "/JXGeoManage/TBL_HAZARDBASICINFO/DETAIL?keyValue=" + keyValue + "&types=" + types,
            //    width: '1300px',
            //    height: '',
            //    callBack: function (iframeId) {
            //        getInfoTop().frames[iframeId].AcceptClick();
            //    },
            //    btn: []
            //});
            var url = document.location.protocol + "//" + document.location.host + "/JXGeoManage/TBL_HAZARDBASICINFO/DETAIL?keyValue=" + keyValue + "&types=" + types + "&callback=" + window.document.URL;
            window.document.location.href = url;
        }
    }

    

    //查询表格函数
    function SearchEvent() {
        var queryJson = $("#filter-form").getWebControls();
        queryJson["DISASTERTYPE"] = tabvalue
        queryJson["PROVINCE"] = PROVINCE;
        queryJson["CITY"] = CITY;
        queryJson["COUNTY"] = COUNTY;
        $("#" + gridId).jqGrid('setGridParam', {
            postData: { queryJson: JSON.stringify(queryJson) },
            url: queryUrl,
            page: 1
        }).trigger('reloadGrid');

        BindMapMarker();
    }

    function ColDataGrid() {
        var centerHeight = $("#layout2").height();
        var layout2 = $('#layout2').layout();
        if ($("#lr-colgrid i").hasClass("fa-chevron-down")) {
            var northH = centerHeight - 105;
            layout2.sizePane("north", northH);
            $("#lr-colgrid i").removeClass("fa-chevron-down");
            $("#lr-colgrid i").addClass("fa-chevron-up");
            if ($("#lr-colmap i").hasClass("fa-chevron-down")) {
                $("#lr-colmap i").removeClass("fa-chevron-down");
                $("#lr-colmap i").addClass("fa-chevron-up");
            }
        }
        else {
            layout2.sizePane("north", layout2NorthH);
            $("#lr-colgrid i").removeClass("fa-chevron-up");
            $("#lr-colgrid i").addClass("fa-chevron-down");
        }
        mapCtlExt.updateSize();
    }

    function ColMapDiv() {
        var layout2 = $('#layout2').layout();
        if ($("#lr-colmap i").hasClass("fa-chevron-up")) {
            layout2.sizePane("north", 1);
            $("#lr-colmap i").removeClass("fa-chevron-up");
            $("#lr-colmap i").addClass("fa-chevron-down");
            if ($("#lr-colgrid i").hasClass("fa-chevron-up")) {
                $("#lr-colgrid i").removeClass("fa-chevron-up");
                $("#lr-colgrid i").addClass("fa-chevron-down");
            }
        }
        else {
            layout2.sizePane("north", layout2NorthH);
            $("#lr-colmap i").removeClass("fa-chevron-down");
            $("#lr-colmap i").addClass("fa-chevron-up");
            if (mapCtlExt != null) {
                mapCtlExt.setHeight($("#mapControl").parent().height() - 32 - 4);
            }
        }
        mapCtlExt.updateSize();
    }
</script>
}
