@{
    ViewBag.Title = "列表页面";
    Layout = "~/Views/Shared/_Index.cshtml";
}
<link href="~/Content/styles/report.css" rel="stylesheet" />
<style>
    body, html {
height:100%;
        background:#fff;
        margin:0;
    }
    .ui-layout-center {
        overflow-x: hidden !important;
    }
    .ui-layout-resizer {
        background-color: #f0f3f4 !important;
    }
    .diaochabiao {
        text-align: center;
    }
    .table-top, .table-main, table-bottom {
        margin: 0 20px;
    }
    .table-main td {
        border: 1px solid #D6D6D6;
    }
    .formValue input[type=text] {
        border: 0;
        border-bottom: 1px solid #E0E0E0;
    }
    .diaochabiao .formValue textarea {
        /*height:80px;*/
        border: none;
    }
    .diaochabiao .formTitle {
        text-align: center !important;
        /*width: 135px !important;*/
        background-color: #F5F5F5;
        white-space: inherit;
    }
    .diaochabiao .formCategory {
        font-size: 15px;
        /*color: #3F549E;*/
    }
    .diaochabiao .required {
        color: red;
        padding-left: 5px;
        vertical-align: middle;
    }
    .diaochabiao select {
        border: none;
    }
    .diaochabiao label {
        margin: 0 2px;
    }
    /****************** td中的多个标签并列 START *************/
    .diaochabiao .multi-label-48 {
        width: 48%;
    }

    .diaochabiao .multi-label-48 input {
        float: right;
        width: 70%;
        margin: 0 2px;
    }
    .diaochabiao .multi-label-40 {
        width: 40%;
    }
    .diaochabiao .multi-label-30 {
        width: 30%;
    }
    .diaochabiao .multi-label-30 input {
        float: left;
        width: 70%;
        margin: 0 2px;
    }
    .diaochabiao .multi-label-10 {
        width: 10%;
    }
    .diaochabiao .multi-label-10 input {
        float: left;
    }
    .diaochabiao .multi-label-15 {
        width: 15%;
    }
    .diaochabiao .multi-label-15 input {
        float: left;
        width: 20%;
        margin: 0 2px;
    }
    /*新增*/
    .formValue input[type=text] .diaochabiao .label-1 {
        width: 5%;
    }
    .diaochabiao .label-1 input {
        float: left;
    }
    .diaochabiao .form-control[readonly], fieldset[readonly] .form-control {
        background-color: #fff;
        border: none;
        cursor: default;
    }
    .diaochabiao .form-control {
        border: none;
    }
    /*新增*/
    /****************** td中的多个标签并列 START *************/

    /****************** 保持标题文字两边对其的样式 START *************/
    .KONG {
        padding-left: 24px;
    }
    .diaochabiao .multi-label-rigth-30 {
        width: 30%;
    }
    .diaochabiao .multi-label-rigth-30 input {
        float: right;
        width: 70%;
        margin: 0 2px;
    }
    .diaochabiao .multi-label-rigth-25 {
        width: 20%;
        /*display:none;*/
    }
    .diaochabiao .multi-label-rigth-25 input {
        float: right;
        width: 90%;
        margin: 0 2px;
    }
    /****************** td中的2个input并列 START *************/

    /****************** 保持标题文字两边对其的样式 END *************/
    .ui-priority-secondary {
        background-color: #DCDCDC;
        color: #222222;
    }
    .titlePanel {
        height: 55px;
    }
     .spansa {
        padding: 0 20px !important;
        width:9%;
        text-align:center;
        height:28px;
        line-height:28px;
        min-width:113px
     }
     .divselect {
        width:16%;
     }
     .form-control, .ui-select, .ui-select-text {
         border-radius: 3px;
     }
    .spans {
        padding: 0 20px !important;
        width: 9%;
        text-align: center;
        height: 28px;
        line-height: 28px;
        min-width: 113px;
    }
    #gridTable td, #gridTableA td {
        border-right: 1px solid #ccc !important;
    }
    .ui-jqgrid-btable tr:nth-child(odd) {
        /*background:#DCDCDC*/
    }
</style>

    <div style="width:100%;height:40px;background:#fff">
        <ul class="nav nav-tabs" style="width:100%;background-color: rgba(236, 247, 255, 1);padding-top:1px;height:36px">
            <li class="active" id=""><a href="#JCTJ" data-toggle="tab">基础统计</a></li>
            <li id="li_BTGL"><a href="#YBCTJ" data-toggle="tab">已保存统计报表</a></li>
        </ul>
    </div>

<div id="myTabContent" class="tab-content" style="height:calc(100% - 40px)">
    <div class="tab-pane fade in active" id="JCTJ" style="height:100%;">
        <div id="TjItem">
              <div style="width:100%;border-bottom: 1px solid #ccc;border-top:none; height:40px;line-height:40px;background:#fff;display:flex;align-items: center;">
                   <span style="font-size:14px;padding-left:20px; font-family:微软雅黑;color:#000;">行政区划:</span>
                    <div id="districtsCtls" style="width:90%;"></div>
              </div>
              <div style="width:100%;border-bottom: 1px solid #ccc;border-top:none;height:40px;line-height:40px;background:#fff;display:flex;align-items: center;">
                   <span style="font-size:14px;padding-left:20px; font-family:微软雅黑;color:#000;">筛选条件:</span>
                    <div style="width:90%;height:40px;display:flex;align-items: center;">
                       <span class="spans">统计年度：</span>
                       <input style="width:16%" type="text"  id="Static_Year"  class="form-control input-wdatepicker" onfocus="WdatePicker({dateFmt:'yyyy'})" />
                       <span class="spans">统计单位：</span>
                       <div style="width:16%" id="Static_Unit" type="selectTree" class="ui-select" ></div>
                        <a style="margin-left:30px" id="btn_genercode" onclick="" class="btn btn-primary" style="float:right"><i class="fa fa-save"></i>&nbsp;统计</a>
                    </div>
              </div>
        </div>
        <div style="width:100%;background-color: rgba(236, 247, 255, 1);height: 36px;">
            <ul class="nav nav-tabs" style="float: left; width: 100%;padding-top:1px;height:36px">
                <li id="" class="active"><a href="#TJJG" data-toggle="tab" class="active">统计结果</a></li>
                <li id="li_BTGL"><a href="#TJTB" data-toggle="tab">统计图表</a></li>
                <li style="float:right;margin-right:30px">
                    <a id="ceshi" style="float:right;border:1px solid #ccc;height:33px;border-radius:3px;" class="btn btn-default" data-toggle="modal" data-target="#myModal"><i class="fa fa-search"></i> 存入报表库</a>
                    <a id="Exl_export" style="float:right;border:1px solid #ccc;height:33px;border-radius:3px;" class="btn btn-default"><i class="fa fa-file-excel-o"></i> 导出</a>
                </li>
            </ul>
        </div>
        <div id="" class="tab-content" style="height:calc(100% - 120px)">
            <div class="tab-pane fade in active" id="TJJG" style="height:100%;">
                  <div id="GridContent" class="gridPanel">
                      <table id="gridTable"></table>
                  </div>
            </div>
            <div class="tab-pane fade" id="TJTB" style="height:100%;width:100%;float:left;position:relative">
                  <div id="chartsdata" style="width:90%;height:100%;float:left;"></div>
            </div>
        </div>

    </div>
    <div class="tab-pane fade in" id="YBCTJ" style="height:100%">
        <ul id="YBCTJ_UI" style="display:flex;flex-wrap:wrap;height:100px;overflow-y:scroll">
        
        </ul>
        <div style="width:100%;height:36px;background-color: rgba(236, 247, 255, 1);line-height:36px">
            <ul class="nav nav-tabs" style="float: left; width: 100%;padding-top:0;padding-bottom:1px">
                <li id="li_YBTJJG" class="active"><a href="#YBTJJG" data-toggle="tab" class="active">统计结果</a></li>
                <li id="li_YBTJTB"><a href="#YBTJTB" data-toggle="tab">统计图表</a></li>
            </ul>
        </div>

       <div id="tab_contents" class="tab-content" style="width:100%;height:calc(100% - 136px)">
            <div class="tab-pane fade in active" id="YBTJJG" style="height:100%;">
                  <div class="gridPanel" id="GridContentA">
                        <table id="gridTableA"></table>
                  </div>
            </div>
            <div class="tab-pane fade in" id="YBTJTB" style="height:100%;width:100%;">
               <div style="width:10%;float:right;">
                    <div id="TBtypeA" type="select" style="width: 140px; margin: 1px 4px 8px 4px;display:inline-block;float:right;z-index:10" class="ui-select"></div>
                </div>
                <div id="chartsdataA" style="width:100%;height:calc(100% - 248px);"></div>
            </div>
        </div>

    </div>
</div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    请输入报表名称
                </h4>
            </div>
            <div class="modal-body">
                @*在这里添加一些文本*@
                <input type="text" class="clo" id="tablename" style="width:90%;line-height:26px;border-radius:4px;" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    关闭
                </button>
                <button type="button" class="btn btn-primary" onclick="btn_save()">
                    确定保存
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalCondition" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalCondition">
                    报表详情
                </h4>
            </div>
            <div class="modal-body">
                <div style="width:100%;height:45px;line-height:45px;background:#fff;display:flex;align-items: center;">
                    <span style="font-size:14px;padding-left:20px; font-family:微软雅黑;color:#000;">行政区划:</span>
                    <div style="width:90%;height:100%;display:flex;align-items: center;padding-left:30px">
                        <span class="spans" style="white-space:nowrap;">省:</span>
                        <input style="width: 16%; border-radius: 4px;" type="text" id="PROVINCENAME2" class="form-control" disabled="disabled" />
                        <span class="spans" style="white-space:nowrap;">市:</span>
                        <input style="width: 16%;border-radius:4px;" type="text" id="CITYNAME2" class="form-control" disabled="disabled" />
                        <span class="spans" style="white-space:nowrap;">县（区）:</span>
                        <input style="width: 16%;border-radius:4px;" type="text" id="COUNTRYNAME2" class="form-control" disabled="disabled" />
                    </div>
                </div>
                <div style="width:100%;height:45px;line-height:45px;background:#fff;display:flex">
                    <span style="font-size:14px;padding-left:20px; font-family:微软雅黑;color:#000;">统计条件:</span>
                    <div style="width:90%;height:100%;display:flex;align-items: center;padding-left:30px">
                        <span class="spans" style="white-space:nowrap;">统计年度:</span>
                        <input style="width: 16%; border-radius: 4px;" type="text" id="Static_Year2" class="form-control" disabled="disabled" />
                        <span class="spans" style="white-space:nowrap;">统计单位:</span>
                        <input style="width: 16%;border-radius:4px;" type="text" id="Static_Unit2" class="form-control" disabled="disabled" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
<script src="~/Content/scripts/plugins/districts/multiDistricts.js"></script>
<script src="~/Content/scripts/plugins/echarts/echarts.min.js"></script>
<script src="~/Content/report.js"></script>
<script>    
    var parmCity = "";
    var parmCountry = "";
    var parmTown = "";
    var parmYear = "";
    var echartedatajson = {};
    var authToken = getAuthorizationToken();
    var Showcols = [];
    var Province_Showcols = [
                    { label: '省名称', name: 'provincename', index: 'provincename', width: 200, align: 'center', sortable: true },
                    { label: '灾害点个数', name: 'disastercount', index: 'disastercount', width: 250, align: 'center', sortable: true },
                    { label: '治理规划个数', name: 'zlghcount', index: 'zlghcount', width: "", align: 'center', sortable: true },
    ];
    var City_Showcols = [
                    { label: '省名称', name: 'provincename', index: 'provincename', width: 200, align: 'center', sortable: true },
                    { label: '市名称', name: 'cityname', index: 'cityname', width: 200, align: 'center', sortable: true },
                    { label: '灾害点个数', name: 'disastercount', index: 'disastercount', width: 250, align: 'center', sortable: true },
                    { label: '治理规划个数', name: 'zlghcount', index: 'zlghcount', width: "", align: 'center', sortable: true },
    ];
    var County_Showcols = [
                     { label: '省名称', name: 'provincename', index: 'provincename', width: 200, align: 'center', sortable: true },
                     { label: '市名称', name: 'cityname', index: 'cityname', width: 200, align: 'center', sortable: true },
                     { label: '县名称', name: 'countyname', index: 'countyname', width: 200, align: 'center', sortable: true },
                     { label: '灾害点个数', name: 'disastercount', index: 'disastercount', width: 250, align: 'center', sortable: true },
                     { label: '治理规划个数', name: 'zlghcount', index: 'zlghcount', width: "", align: 'center', sortable: true },
    ];

    $(function () {
        initControl();
        InitialPage();
        GetGrid();

        //查询点击事件
        $("#btn_genercode").click(function () {
            SearchEvent();
        });
        //导出点击事件
        $("#Exl_export").click(function () {
            EXL_Export();
        });
        $('#YBCTJ_UI').report({
            module: 'TBL_ACHIEVEMENT_PREPLANAnalyse',
            viewReport: function (data) {
                if (data != null) {
                    queryJson = JSON.parse(data.QUERYSTRING);
                    showDta = JSON.parse(data.CONDITION);
                    excelinfo(queryJson)
                }

            },
            ViewModal: function (data) {
                queryJson = JSON.parse(data.QUERYSTRING);
                $("#PROVINCENAME2").val(queryJson.PROVINCENAME);
                $("#CITYNAME2").val(queryJson.CITYNAME);
                $("#COUNTRYNAME2").val(queryJson.COUNTRYNAME);
                $("#Static_Year2").val(queryJson.Static_Year);
                $("#Static_Unit2").val(queryJson.Static_Unit);
                $("#myModal2").modal("show");
            },
            success: function (data) {
                $("#myModal").modal("hide");
            }
        });
    });


    //初始化控件
    function initControl() {
        //行政区划加载
        var usercode = usercodes();
        var district = $("#districtsCtls").mulDistrictsCtl({
            provinceId: usercode.provinceId,
            selectProviceId: usercode.provinceId,
            selectCityId: usercode.selectCityId,
            showTown: false,
            type: 'B',
        });
        //统计单位
        $("#Static_Unit").ComboBox({
            id: "value",
            text: "label",
            height: "170px",
            data: [
                { label: "省", value: "省" },
                { label: "市", value: "市" },
                { label: "县", value: "县" },

            ],
            Itemindex: 1,
        });
        //默认选中第二个
        $("#Static_Unit").ComboBoxSetValue("市");
    }


    //页面排版信息初始化
    function InitialPage() {
        var isResize = 0;
        var count = 0;
        var resized = 0;
        $(window).resize(function (e) {
            if (isResize < 10) {
                isResize++;
            }
            resize();
            e.stopPropagation();
        });
        //resize重设布局;
        $(window).resize(function (e) {
            window.setTimeout(function () {
                $('#gridTable').setGridWidth(($(window).width()));
                $('#gridTable').setGridHeight($(window).height() - 136.5 + 40);
            }, 200);
            e.stopPropagation();
        });
        function resize() {
            window.setTimeout(function () {
                $('#chartsdata').width($(window).width());
                $('#chartsdata').height($(window).height() - 215);
                $('#chartsdataA').width($(window).width());
                $('#chartsdataA').height($(window).height() - 275);
                $('#gridTable').setGridWidth(($(window).width()));
                $('#gridTableA').setGridWidth(($(window).width()));
                $('#gridTable').setGridHeight($(window).height() - 136.5 + 75);
                $('#gridTableA').$(window).height() - 263.5 + 55;
                var myChart = echarts.init(document.getElementById("chartsdata"));
                myChart.resize();
                var myChartA = echarts.init(document.getElementById("chartsdataA"));
                myChartA.resize();
            }, 200);
        };
        //调整图表大小
        $('#chartsdata').width($(window).width());
        $('#chartsdata').height($(window).height() - 215);
        $('#chartsdataA').width($(window).width());
        $('#chartsdataA').height($(window).height() - 275);
        $('#gridTable').setGridHeight($(window).height() - 136.5 + 75);
        $('#gridTable').setGridWidth(($(window).width()));
    }

   


    //点击查询事件
    function SearchEvent() {
        //$("#gridTable").jqGrid('GridUnload');
        $("#GridContent").empty();
        $("#GridContent").append('<table id="gridTable"></table><div id="gridPager"></div>');
        var unitZLGH = $("#Static_Unit").attr("data-value");
        var yearZLGH = $("#Static_Year").val();
        parmYear = yearZLGH;
        //获得市、县的内容
        if ($("#CITY .ui-select-text").html() != undefined) {
            parmCity = $("#CITY .ui-select-text").html();
        }
        if ($("#CITY .ui-select-text").html() == "选择市") {
            parmCity = "";
        }
        if ($("#COUNTY .ui-select-text").html() != undefined) {
            parmCountry = $("#COUNTY .ui-select-text").html();
        }
        if ($("#COUNTY .ui-select-text").html() == "选择县") {
            parmCountry = "";
        }
        var queryConditon = { "PROVINCENAME": DefalutName, "CITYNAME": parmCity, "COUNTRYNAME": parmCountry, "Static_Unit": unitZLGH, "Static_Year": yearZLGH };
        GetGrid(queryConditon);
        $('#gridTable').setGridWidth(($(window).width() - 22));
    }
    
    //报表初始化点击选中事件
    function excelinfo(duixiang) {
        var queryConditon = { "PROVINCENAME": DefalutName, "CITYNAME": duixiang.CITYNAME, "COUNTRYNAME": duixiang.COUNTRYNAME, "Static_Unit": duixiang.Static_Unit, "Static_Year": duixiang.Static_Year };
        $("#GridContentA").empty();
        $("#GridContentA").append('<table id="gridTableA"></table><div id="gridPager"></div>');
        Report_GetGrid(queryConditon);
        $('#gridTableA').setGridWidth(($(window).width()));
    }

    //存入报表库
    function btn_save() {
        var queryJson = $("#TjItem").getWebControls();
        queryJson['PROVINCENAME'] = DefalutName;
        queryJson['CITYNAME'] = parmCity;
        queryJson['COUNTRYNAME'] = parmCountry;
        queryJson['TOWNNAME'] = parmTown;
        $('#YBCTJ_UI').SaveReport($('#tablename').val(), JSON.stringify(queryJson), "");
    }


    //加载图表
    function LoadChart(data, name, pictype) {
        var myChart = echarts.init(document.getElementById("chartsdata"));
        // 指定图表的配置项和数据
        var option = {
            title: {

            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: ['灾害点数量', '防治规划数'],
                x: 'center',
                y: 30,
                padding: [5, 35, 5, 5]
            },
            grid: {
                "borderWidth": 0,
                top: 100,
                containLabel: true
            },
            xAxis: {
                data: name,
                name: '行政区划',
                axisLabel: {
                    interval: 0,
                    rotate: -30
                }
            },
            yAxis: {
                type: 'value',
                name: '个数'
            },

            series: [{
                        name: '灾害点数量', type: pictype, data: data.data_disastercount,
                        itemStyle: { normal: { label: { show: true, position: 'top' } } }
                    },
                   {
                       name: '防治规划数', type: pictype, data: data.data_zlghcount,
                       itemStyle: { normal: { label: { show: true, position: 'top' } } }
                   }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option, true);
    }

    //关于报表-加载图表
    function LoadChartA(data, name, pictype) {
        var myChart = echarts.init(document.getElementById("chartsdataA"));
        // 指定图表的配置项和数据
        var option = {
            title: {

            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: ['灾害点数量', '治理工程数'],
                x: 'center',
                y: 30,
                padding: [5, 35, 5, 5]
            },
            grid: {
                "borderWidth": 0,
                top: 100,
                containLabel: true
            },
            xAxis: {
                data: name,
                name: '行政区划',
                axisLabel: {
                    interval: 0,
                    rotate: -30
                }
            },
            yAxis: {
                type: 'value',
                name: '个数'
            },

            series: [{
                name: '灾害点数量', type: pictype, data: data.data_disastercount,
                itemStyle: { normal: { label: { show: true, position: 'top' } } }
            },
                   {
                       name: '治理工程数', type: pictype, data: data.data_zlgccount,
                       itemStyle: { normal: { label: { show: true, position: 'top' } } }
                   }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option, true);
    }



    //不带年份加载表格
    function GetGrid(queryConditon) {
        var selectedRowIndex = 0;
        if (queryConditon != null) {
            queryJson = queryConditon;
            if (queryJson.Static_Unit == "省") {
                Showcols = Province_Showcols;
            }
            if (queryJson.Static_Unit == "市") {
                Showcols = City_Showcols;
            }
            if (queryJson.Static_Unit == "县") {
                Showcols = County_Showcols;
            }
        }
        else {
            queryJson = $("#TjItem").getWebControls();
            queryJson['PROVINCENAME'] = DefalutName;
            queryJson['CITYNAME'] = parmCity;
            queryJson['COUNTRYNAME'] = parmCountry;
            queryJson['TOWNNAME'] = parmTown;
            Showcols = City_Showcols;
        }
        var $gridTable = $('#gridTable');
        $gridTable.jqGrid({
            autowidth: false,
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            height: $(window).height() - 263.5 + 75,
            url: "../../api/TBL_ACHIEVEMENT_PREPLAN/PREPLANCountStatics",
            datatype: "json",
            postData: { queryJson: JSON.stringify(queryJson) },
            colModel: Showcols,
            viewrecords: true,
            rowNum: 30000,
            sortorder: 'desc',
            rownumbers: false,
            shrinkToFit: true,
            gridview: true,
            altRows: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            },
            loadComplete: function (jsondata) {
                //每次重新加载都要清空变量
                var dataX = [];
                var data_disastercount = [];
                var data_zlghcount = [];
                //省
                if (jsondata.length == 1) {
                    if (jsondata != null && jsondata.length > 0) {
                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].cityname == "" || jsondata[i].cityname == null) {
                                dataX.push(jsondata[i].provincename);
                            }
                            else {
                                dataX.push(jsondata[i].cityname);
                            }
                            data_disastercount.push(jsondata[i].disastercount);
                            data_zlghcount.push(jsondata[i].zlghcount);
                        };
                    }
                }
                //市
                if (jsondata != null && jsondata.length > 1) {
                    if (jsondata[1].cityname != "" && jsondata[2] == undefined || jsondata[2].countyname == undefined) {

                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].cityname == "" || jsondata[i].cityname == null) {

                            }
                            else {
                                dataX.push(jsondata[i].cityname);
                                data_disastercount.push(jsondata[i].disastercount);
                                data_zlghcount.push(jsondata[i].zlghcount);
                            }
                        };
                    }
                }
                //县
                if (jsondata != null && jsondata.length > 2) {
                    if (jsondata[1].cityname != "" && jsondata[2].countryname != "") {
                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].provincename == "" && jsondata[i].cityname == "" && jsondata[i].countyname != "") {
                                dataX.push(jsondata[i].countyname);
                                data_disastercount.push(jsondata[i].disastercount);
                                data_zlghcount.push(jsondata[i].zlghcount);
                            }
                        };
                    }
                }
                var echartedatajsonA = { "dataX": "", "data_disastercount": "", "data_zlghcount": "" };
                echartedatajsonA['dataX'] = dataX;
                echartedatajsonA['data_disastercount'] = data_disastercount;
                echartedatajsonA['data_zlghcount'] = data_zlghcount;
                echartedatajson = echartedatajsonA;
                LoadChart(echartedatajson, echartedatajson.dataX, "bar");
            }
        });
    }

    //报表统计加载表格
    function Report_GetGrid(queryConditon) {
        var selectedRowIndex = 0;
        if (queryConditon != null) {
            queryJson = queryConditon;
            if (queryJson.Static_Unit == "省") {
                Showcols = Province_Showcols;
            }
            if (queryJson.Static_Unit == "市") {
                Showcols = City_Showcols;
            }
            if (queryJson.Static_Unit == "县") {
                Showcols = County_Showcols;
            }
        }
        else {
            queryJson = $("#TjItem").getWebControls();
            queryJson['PROVINCENAME'] = DefalutName;
            queryJson['CITYNAME'] = parmCity;
            queryJson['COUNTRYNAME'] = parmCountry;
            queryJson['TOWNNAME'] = parmTown;
            Showcols = City_Showcols;
        }
        var $gridTable = $('#gridTableA');
        $gridTable.jqGrid({
            autowidth: false,
            loadBeforeSend: function (a) {
                a.setRequestHeader("Authorization", authToken);
            },
            height: $(window).height() - 263.5 + 55,
            url: "../../api/TBL_ACHIEVEMENT_PREPLAN/PREPLANCountStatics",
            datatype: "json",
            postData: { queryJson: JSON.stringify(queryJson) },
            colModel: Showcols,
            viewrecords: true,
            rowNum: 30000,
            sortorder: 'desc',
            rownumbers: false,
            shrinkToFit: true,
            gridview: true,
            altRows: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            },
            loadComplete: function (jsondata) {
                //每次重新加载都要清空变量
                var dataX = [];
                var data_disastercount = [];
                var data_zlghcount = [];
                //省
                if (jsondata.length == 1) {
                    if (jsondata != null && jsondata.length > 0) {
                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].cityname == "" || jsondata[i].cityname == null) {
                                dataX.push(jsondata[i].provincename);
                            }
                            else {
                                dataX.push(jsondata[i].cityname);
                            }
                            data_disastercount.push(jsondata[i].disastercount);
                            data_zlghcount.push(jsondata[i].zlghcount);
                        };
                    }
                }
                //市
                if (jsondata != null && jsondata.length > 1) {
                    if (jsondata[1].cityname != "" && jsondata[2] == undefined || jsondata[2].countyname == undefined) {

                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].cityname == "" || jsondata[i].cityname == null) {

                            }
                            else {
                                dataX.push(jsondata[i].cityname);
                                data_disastercount.push(jsondata[i].disastercount);
                                data_zlghcount.push(jsondata[i].zlghcount);
                            }
                        };
                    }
                }
                //县
                if (jsondata != null && jsondata.length > 2) {
                    if (jsondata[1].cityname != "" && jsondata[2].countryname != "") {
                        for (var i = 0; i < jsondata.length; i++) {
                            if (jsondata[i].provincename == "" && jsondata[i].cityname == "" && jsondata[i].countyname != "") {
                                dataX.push(jsondata[i].countyname);
                                data_disastercount.push(jsondata[i].disastercount);
                                data_zlghcount.push(jsondata[i].zlghcount);
                            }
                        };
                    }
                }
                var echartedatajsonA = { "dataX": "", "data_disastercount": "", "data_zlghcount": "" };
                echartedatajsonA['dataX'] = dataX;
                echartedatajsonA['data_disastercount'] = data_disastercount;
                echartedatajsonA['data_zlghcount'] = data_zlghcount;
                echartedatajson = echartedatajsonA;
                LoadChartA(echartedatajson, echartedatajson.dataX, "bar");
            }
        });
    }

    //对应导出
    function EXL_Export() {
        var unitZLGH = $("#Static_Unit").attr("data-value");
        var yearZLGH = $("#Static_Year").val();
        parmYear = yearZLGH;
        //获得市、县的内容
        if ($("#CITY .ui-select-text").html() != undefined) {
            parmCity = $("#CITY .ui-select-text").html();
        }
        if ($("#CITY .ui-select-text").html() == "选择市") {
            parmCity = "";
        }
        if ($("#COUNTY .ui-select-text").html() != undefined) {
            parmCountry = $("#COUNTY .ui-select-text").html();
        }
        if ($("#COUNTY .ui-select-text").html() == "选择县") {
            parmCountry = "";
        }
        var queryConditon = { "PROVINCENAME": DefalutName, "CITYNAME": parmCity, "COUNTRYNAME": parmCountry, "Static_Unit": unitZLGH, "Static_Year": yearZLGH };
        location.href = "../../JXGeoManage/TBL_ACHIEVEMENT_PREPLAN/ExcelZLGHCountDownloadExt?queryJson=" + JSON.stringify(queryConditon);
    }


</script>
<script>

</script>
}
